<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QA Process Data - C√¥ng ngh·ªá m√¨</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#0078d4">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* Development mode indicators */
        .dev-indicator {
            background: linear-gradient(45deg, #dc3545, #fd7e14);
            color: white;
            padding: 5px 15px;
            font-size: 0.8rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 35px; /* Account for dev indicator */
            left: 0;
            height: calc(100vh - 35px);
            width: 280px;
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        
        .sidebar.collapsed {
            transform: translateX(-100%);
        }
        
        .sidebar-header {
            padding: 1rem;
            background: #0078d4;
            color: white;
        }
        
        .sidebar-nav {
            padding: 0;
        }
        
        .nav-section {
            margin-bottom: 1rem;
        }
        
        .nav-section-title {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .nav-item {
            margin: 0;
        }
        
        .nav-link {
            padding: 0.75rem 1rem;
            color: #495057;
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }
        
        .nav-link:hover {
            background: #e9ecef;
            color: #0078d4;
        }
        
        .nav-link.active {
            background: #0078d4;
            color: white;
            border-right: 3px solid #0056b3;
        }
        
        .nav-link i {
            width: 20px;
            margin-right: 0.75rem;
        }
        
        /* Main content with sidebar */
        .main-content {
            margin-left: 280px;
            margin-top: 35px; /* Account for dev indicator */
            transition: margin-left 0.3s ease;
        }
        
        .main-content.expanded {
            margin-left: 0;
        }
        
        /* Top navbar */
        .top-navbar {
            position: fixed;
            top: 35px; /* Account for dev indicator */
            left: 280px;
            right: 0;
            height: 60px;
            background: white;
            border-bottom: 1px solid #dee2e6;
            z-index: 999;
            transition: left 0.3s ease;
            display: flex;
            align-items: center;
            padding: 0 1rem;
        }
        
        .top-navbar.expanded {
            left: 0;
        }
        
        .content-area {
            padding-top: 60px; /* Account for top navbar */
            min-height: calc(100vh - 95px);
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 300px;
            }
            
            .sidebar.show {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .top-navbar {
                left: 0;
            }
            
            .sidebar-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                z-index: 999;
                display: none;
            }
            
            .sidebar-overlay.show {
                display: block;
            }
        }
        
        /* Form container */
        .form-container {
            display: none;
        }
        
        .form-container.active {
            display: block;
        }
        
        /* Breadcrumb */
        .breadcrumb-container {
            background: #f8f9fa;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #dee2e6;
        }
        
        .dev-tools {
            position: fixed;
            bottom: 10px;
            right: 10px;
            z-index: 1000;
        }
        
        .dev-tools .btn {
            margin: 2px;
            font-size: 0.8rem;
        }
        
        /* Sidebar toggle button */
        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #495057;
            cursor: pointer;
        }
        
        .sidebar-toggle:hover {
            color: #0078d4;
        }

        /* Grid selection styles for metal detection */
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .selection-grid .grid-btn:nth-child(8),
        .selection-grid .grid-btn:nth-child(9),
        .selection-grid .grid-btn:nth-child(10) {
            grid-column: span 1;
        }

        .grid-btn {
            border: 2px solid #dee2e6;
            background: white;
            padding: 0.75rem;
            text-align: center;
            cursor: pointer;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .grid-btn:hover {
            border-color: #0078d4;
            background: #f0f8ff;
        }

        .grid-btn.selected {
            border-color: #0078d4;
            background: #0078d4;
            color: white;
        }

        .grid-btn:focus {
            outline: none;
            box-shadow: 0 0 0 0.2rem rgba(0, 120, 212, 0.25);
        }

        /* Responsive grid */
        @media (max-width: 768px) {
            .selection-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 0.25rem;
            }
            
            .grid-btn {
                padding: 0.5rem;
                font-size: 0.875rem;
                min-height: 40px;
            }
        }

        @media (max-width: 576px) {
            .selection-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Input group styling */
        .input-group .form-control[readonly] {
            background-color: white;
        }

        /* File input camera styling */
        input[type="file"][capture="camera"] {
            border: 2px dashed #dee2e6;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <!-- Development Mode Indicator -->
    <div class="dev-indicator">
        <strong>üöß DEVELOPMENT MODE</strong> - Mock data ƒë∆∞·ª£c s·ª≠ d·ª•ng | No SharePoint connection
    </div>

    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">ƒêang t·∫£i ·ª©ng d·ª•ng (Development Mode)...</p>
    </div>

    <!-- Login Screen (Hidden in dev mode) -->
    <div id="loginScreen" class="login-screen" style="display: none;">
        <div class="container">
            <div class="row justify-content-center align-items-center min-vh-100">
                <div class="col-md-6 col-lg-4">
                    <div class="card shadow">
                        <div class="card-body p-4">
                            <div class="text-center mb-4">
                                <i class="bi bi-clipboard-data text-primary" style="font-size: 3rem;"></i>
                                <h4 class="mt-3">QA Process Data</h4>
                                <p class="text-muted">C√¥ng ngh·ªá m√¨</p>
                            </div>
                            <button id="loginButton" class="btn btn-primary w-100">
                                <i class="bi bi-microsoft me-2"></i>
                                ƒêƒÉng nh·∫≠p v·ªõi Microsoft
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        
        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h6 class="mb-0">
                    <i class="bi bi-clipboard-data me-2"></i>
                    QA System <small class="badge bg-danger ms-2">DEV</small>
                </h6>
                <small class="opacity-75">Quality Assurance Management</small>
            </div>
            
            <nav class="sidebar-nav">
                <!-- Dashboard Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Dashboard</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-form="dashboard">
                            <i class="bi bi-speedometer2"></i>
                            <span>T·ªïng quan</span>
                        </a>
                    </div>
                </div>
                
                <!-- Data Entry Forms -->
                <div class="nav-section">
                    <div class="nav-section-title">Nh·∫≠p d·ªØ li·ªáu</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link active" data-form="process-data">
                            <i class="bi bi-clipboard-data"></i>
                            <span>Process Data</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-form="metal-detection">
                            <i class="bi bi-shield-check"></i>
                            <span>Ki·ªÉm so√°t m√°y d√≤ kim lo·∫°i</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-form="daily-hygiene">
                            <i class="bi bi-droplet-half"></i>
                            <span>ƒê√°nh gi√° v·ªá sinh h√†ng ng√†y</span>
                        </a>
                    </div>
                </div>
                
                <!-- Reports -->
                <div class="nav-section">
                    <div class="nav-section-title">B√°o c√°o</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-form="data-view">
                            <i class="bi bi-table"></i>
                            <span>Xem d·ªØ li·ªáu</span>
                        </a>
                    </div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-form="analytics">
                            <i class="bi bi-graph-up"></i>
                            <span>Ph√¢n t√≠ch</span>
                        </a>
                    </div>
                </div>
                
                <!-- Settings -->
                <div class="nav-section">
                    <div class="nav-section-title">C√†i ƒë·∫∑t</div>
                    <div class="nav-item">
                        <a href="#" class="nav-link" data-form="parameters">
                            <i class="bi bi-gear"></i>
                            <span>Th√¥ng s·ªë</span>
                        </a>
                    </div>
                </div>
            </nav>
        </div>
        
        <!-- Top Navbar -->
        <div class="top-navbar" id="topNavbar">
            <button class="sidebar-toggle d-md-none" id="sidebarToggle">
                <i class="bi bi-list"></i>
            </button>
            
            <div class="ms-auto d-flex align-items-center">
                <span class="text-muted me-3">
                    <i class="bi bi-person-circle me-1"></i>
                    <span id="userName">Developer Mode</span>
                </span>
                <button class="btn btn-outline-secondary btn-sm" id="logoutBtn">
                    <i class="bi bi-box-arrow-right me-1"></i> Reload
                </button>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content" id="mainContent">
            <div class="content-area">
                
                <!-- Breadcrumb -->
                <div class="breadcrumb-container">
                    <nav>
                        <ol class="breadcrumb mb-0">
                            <li class="breadcrumb-item">
                                <i class="bi bi-house me-1"></i>
                                <a href="#">Home</a>
                            </li>
                            <li class="breadcrumb-item active" id="currentFormBreadcrumb">Process Data</li>
                        </ol>
                    </nav>
                </div>
                
                <!-- Form Containers -->
                
                <!-- Dashboard Form -->
                <div class="form-container" id="dashboard-form">
                    <div class="container-fluid py-4">
                        <div class="row">
                            <div class="col-12">
                                <h4 class="mb-4">
                                    <i class="bi bi-speedometer2 me-2"></i>
                                    Dashboard - T·ªïng quan h·ªá th·ªëng QA
                                </h4>
                            </div>
                        </div>
                        
                        <!-- Stats Cards -->
                        <div class="row mb-4">
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-clipboard-data text-primary" style="font-size: 2rem;"></i>
                                        <h5 class="card-title mt-2" id="totalRecords">0</h5>
                                        <p class="card-text text-muted">Process Records</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-shield-check text-success" style="font-size: 2rem;"></i>
                                        <h5 class="card-title mt-2" id="metalDetectionRecords">0</h5>
                                        <p class="card-text text-muted">Metal Detection</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-building text-info" style="font-size: 2rem;"></i>
                                        <h5 class="card-title mt-2">4</h5>
                                        <p class="card-text text-muted">Sites</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <i class="bi bi-clock text-warning" style="font-size: 2rem;"></i>
                                        <h5 class="card-title mt-2" id="todayRecords">0</h5>
                                        <p class="card-text text-muted">Records h√¥m nay</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="row">
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Quick Actions</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary" onclick="app.switchForm('process-data')">
                                                <i class="bi bi-plus-circle me-2"></i>
                                                Nh·∫≠p Process Data m·ªõi
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="app.switchForm('metal-detection')">
                                                <i class="bi bi-shield-check me-2"></i>
                                                Ki·ªÉm so√°t m√°y d√≤ kim lo·∫°i
                                            </button>
                                            <button class="btn btn-outline-primary" onclick="app.switchForm('data-view')">
                                                <i class="bi bi-table me-2"></i>
                                                Xem d·ªØ li·ªáu ƒë√£ nh·∫≠p
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">D·ªØ li·ªáu g·∫ßn ƒë√¢y</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="recentRecords">
                                            <p class="text-muted">ƒêang t·∫£i...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Process Data Form -->
                <div class="form-container active" id="process-data-form">
                    <div class="container-fluid py-4">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-pencil-square me-2"></i>
                                    Nh·∫≠p d·ªØ li·ªáu ki·ªÉm tra Process
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="processDataForm">
                                    <!-- Basic Information -->
                                    <div class="row mb-3">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Site <span class="text-danger">*</span></label>
                                            <select class="form-select" id="site" required>
                                                <option value="">Ch·ªçn site...</option>
                                                <option value="MMB">MMB</option>
                                                <option value="MSI">MSI</option>
                                                <option value="MHD">MHD</option>
                                                <option value="MHG">MHG</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">M√£ nh√¢n vi√™n QA <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="maNhanVien" required placeholder="VD: QA001">
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Line SX <span class="text-danger">*</span></label>
                                            <select class="form-select" id="lineSX" required>
                                                <option value="">Ch·ªçn line...</option>
                                                <option value="L1">L1</option>
                                                <option value="L2">L2</option>
                                                <option value="L3">L3</option>
                                                <option value="L4">L4</option>
                                                <option value="L5">L5</option>
                                                <option value="L6">L6</option>
                                                <option value="L7">L7</option>
                                                <option value="L8">L8</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">M√£ ƒêKSX <span class="text-danger">*</span></label>
                                            <select class="form-select" id="maDKSX" required>
                                                <option value="">Ch·ªçn m√£ ƒêKSX...</option>
                                            </select>
                                            <small class="text-muted">S·∫£n ph·∫©m: <span id="productName">-</span></small>
                                        </div>
                                    </div>

                                    <!-- Kansui Section -->
                                    <h6 class="border-bottom pb-2 mb-3 text-primary">
                                        <i class="bi bi-droplet me-2"></i>Th√¥ng s·ªë Kansui
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Brix Kansui</label>
                                            <input type="number" class="form-control" id="brixKansui" step="0.1" min="0" placeholder="VD: 8.2">
                                            <small class="text-muted">Range: <span id="brixKansuiRange">-</span></small>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Nhi·ªát ƒë·ªô Kansui (¬∞C)</label>
                                            <input type="number" class="form-control" id="nhietDoKansui" step="0.1" min="0" placeholder="VD: 22.5">
                                            <small class="text-muted">Range: <span id="nhietKansuiRange">-</span></small>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Ngo·∫°i quan Kansui</label>
                                            <select class="form-select" id="ngoaiQuanKansui">
                                                <option value="">Ch·ªçn...</option>
                                                <option value="ƒê·∫°t">ƒê·∫°t</option>
                                                <option value="Kh√¥ng ƒë·∫°t">Kh√¥ng ƒë·∫°t</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Seasoning Section -->
                                    <h6 class="border-bottom pb-2 mb-3 text-primary">
                                        <i class="bi bi-cup-hot me-2"></i>Th√¥ng s·ªë Seasoning
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Brix Seasoning</label>
                                            <input type="number" class="form-control" id="brixSeasoning" step="0.1" min="0" placeholder="VD: 20.5">
                                            <small class="text-muted">Range: <span id="brixSeaRange">-</span></small>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Ngo·∫°i quan Seasoning</label>
                                            <select class="form-select" id="ngoaiQuanSeasoning">
                                                <option value="">Ch·ªçn...</option>
                                                <option value="ƒê·∫°t">ƒê·∫°t</option>
                                                <option value="Kh√¥ng ƒë·∫°t">Kh√¥ng ƒë·∫°t</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">ƒê·ªô d√†y l√° b·ªôt (mm)</label>
                                            <input type="number" class="form-control" id="doDayLaBot" step="0.01" min="0" placeholder="VD: 1.5">
                                            <small class="text-muted">Range: <span id="doDayRange">-</span></small>
                                        </div>
                                    </div>

                                    <!-- Temperature Section -->
                                    <h6 class="border-bottom pb-2 mb-3 text-primary">
                                        <i class="bi bi-thermometer-half me-2"></i>Nhi·ªát ƒë·ªô chi√™n (¬∞C)
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">ƒê·∫ßu tr√°i</label>
                                            <input type="number" class="form-control" id="nhietDauTrai" step="0.1" placeholder="168">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">ƒê·∫ßu ph·∫£i</label>
                                            <input type="number" class="form-control" id="nhietDauPhai" step="0.1" placeholder="170">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Gi·ªØa 1 tr√°i</label>
                                            <input type="number" class="form-control" id="nhietGiua1Trai" step="0.1" placeholder="172">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Gi·ªØa 1 ph·∫£i</label>
                                            <input type="number" class="form-control" id="nhietGiua1Phai" step="0.1" placeholder="175">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Gi·ªØa 2 tr√°i</label>
                                            <input type="number" class="form-control" id="nhietGiua2Trai" step="0.1" placeholder="170">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Gi·ªØa 2 ph·∫£i</label>
                                            <input type="number" class="form-control" id="nhietGiua2Phai" step="0.1" placeholder="173">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Gi·ªØa 3 tr√°i</label>
                                            <input type="number" class="form-control" id="nhietGiua3Trai" step="0.1" placeholder="169">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Gi·ªØa 3 ph·∫£i</label>
                                            <input type="number" class="form-control" id="nhietGiua3Phai" step="0.1" placeholder="171">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Cu·ªëi tr√°i</label>
                                            <input type="number" class="form-control" id="nhietCuoiTrai" step="0.1" placeholder="165">
                                        </div>
                                        <div class="col-6 col-md-3 mb-3">
                                            <label class="form-label">Cu·ªëi ph·∫£i</label>
                                            <input type="number" class="form-control" id="nhietCuoiPhai" step="0.1" placeholder="167">
                                        </div>
                                    </div>

                                    <!-- Sensory Evaluation -->
                                    <h6 class="border-bottom pb-2 mb-3 text-primary">
                                        <i class="bi bi-star me-2"></i>ƒê√°nh gi√° c·∫£m quan
                                    </h6>
                                    <div class="row mb-3">
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">C∆° t√≠nh s·ª£i</label>
                                            <select class="form-select" id="camQuanCoTinh">
                                                <option value="">Ch·ªçn...</option>
                                                <option value="8.9">8.9</option>
                                                <option value="9.0">9.0</option>
                                                <option value="9.1">9.1</option>
                                                <option value="9.2">9.2</option>
                                                <option value="9.3">9.3</option>
                                                <option value="9.4">9.4</option>
                                                <option value="9.5">9.5</option>
                                                <option value="9.6">9.6</option>
                                                <option value="9.7">9.7</option>
                                                <option value="9.8">9.8</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">M√†u s·∫Øc</label>
                                            <select class="form-select" id="camQuanMau">
                                                <option value="">Ch·ªçn...</option>
                                                <option value="8.9">8.9</option>
                                                <option value="9.0">9.0</option>
                                                <option value="9.1">9.1</option>
                                                <option value="9.2">9.2</option>
                                                <option value="9.3">9.3</option>
                                                <option value="9.4">9.4</option>
                                                <option value="9.5">9.5</option>
                                                <option value="9.6">9.6</option>
                                                <option value="9.7">9.7</option>
                                                <option value="9.8">9.8</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">M√πi</label>
                                            <select class="form-select" id="camQuanMui">
                                                <option value="">Ch·ªçn...</option>
                                                <option value="8.9">8.9</option>
                                                <option value="9.0">9.0</option>
                                                <option value="9.1">9.1</option>
                                                <option value="9.2">9.2</option>
                                                <option value="9.3">9.3</option>
                                                <option value="9.4">9.4</option>
                                                <option value="9.5">9.5</option>
                                                <option value="9.6">9.6</option>
                                                <option value="9.7">9.7</option>
                                                <option value="9.8">9.8</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <label class="form-label">V·ªã</label>
                                            <select class="form-select" id="camQuanVi">
                                                <option value="">Ch·ªçn...</option>
                                                <option value="8.9">8.9</option>
                                                <option value="9.0">9.0</option>
                                                <option value="9.1">9.1</option>
                                                <option value="9.2">9.2</option>
                                                <option value="9.3">9.3</option>
                                                <option value="9.4">9.4</option>
                                                <option value="9.5">9.5</option>
                                                <option value="9.6">9.6</option>
                                                <option value="9.7">9.7</option>
                                                <option value="9.8">9.8</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Submit Buttons -->
                                    <div class="d-flex gap-2 justify-content-end">
                                        <button type="button" class="btn btn-secondary" id="resetBtn">
                                            <i class="bi bi-arrow-clockwise me-2"></i>L√†m m·ªõi
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="bi bi-save me-2"></i>L∆∞u d·ªØ li·ªáu
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Metal Detection Form -->
                <div class="form-container" id="metal-detection-form">
                    <div class="container-fluid py-4">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-shield-check me-2"></i>
                                    Ki·ªÉm so√°t m√°y d√≤ kim lo·∫°i
                                </h5>
                            </div>
                            <div class="card-body">
                                <form id="metalDetectionForm">
                                    <!-- Basic Information -->
                                    <div class="row mb-4">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">ID <span class="text-primary">*</span></label>
                                            <input type="text" class="form-control" id="mdId" readonly style="background-color: #f8f9fa;">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Site <span class="text-danger">*</span></label>
                                            <select class="form-select" id="mdSite" required>
                                                <option value="">Ch·ªçn site...</option>
                                                <option value="MMB">MMB</option>
                                                <option value="MSI">MSI</option>
                                                <option value="MHD">MHD</option>
                                                <option value="MHG">MHG</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-4">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">M√£ nh√¢n vi√™n QA</label>
                                            <input type="text" class="form-control" id="mdMaNhanVien" placeholder="VD: 25MB03590">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Ng√†y s·∫£n xu·∫•t</label>
                                            <input type="date" class="form-control" id="mdNgaySanXuat">
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label">Gi·ªù ki·ªÉm tra</label>
                                            <input type="time" class="form-control" id="mdGioKiemTra">
                                        </div>
                                    </div>

                                    <!-- Unit through detector -->
                                    <div class="mb-4">
                                        <label class="form-label">ƒê∆°n v·ªã qua m√°y d√≤</label>
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="donViQuaMayDo" id="mdGoi" value="G√≥i">
                                                    <label class="form-check-label" for="mdGoi">G√≥i</label>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="donViQuaMayDo" id="mdThung" value="Th√πng">
                                                    <label class="form-check-label" for="mdThung">Th√πng</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Line Selection -->
                                    <div class="mb-4">
                                        <label class="form-label">Line</label>
                                        <div class="selection-grid" id="lineGrid">
                                            <button type="button" class="grid-btn" data-value="1">1</button>
                                            <button type="button" class="grid-btn" data-value="2">2</button>
                                            <button type="button" class="grid-btn" data-value="3">3</button>
                                            <button type="button" class="grid-btn" data-value="4">4</button>
                                            <button type="button" class="grid-btn" data-value="5">5</button>
                                            <button type="button" class="grid-btn" data-value="6">6</button>
                                            <button type="button" class="grid-btn" data-value="7">7</button>
                                            <button type="button" class="grid-btn" data-value="8">8</button>
                                            <button type="button" class="grid-btn" data-value="9">9</button>
                                        </div>
                                        <input type="hidden" id="mdLine" name="line">
                                    </div>

                                    <!-- Magnetic contamination setting -->
                                    <div class="row mb-4">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Ng∆∞·ªùi nhi·ªÖm t·ª´ c√†i ƒë·∫∑t <span class="text-primary">*</span></label>
                                            <div class="input-group">
                                                <button class="btn btn-outline-secondary" type="button" onclick="adjustNumber('mdNguoiNhiemTu', -0.01)">-</button>
                                                <input type="number" class="form-control text-center" id="mdNguoiNhiemTu" value="0.00" step="0.01" readonly>
                                                <button class="btn btn-outline-secondary" type="button" onclick="adjustNumber('mdNguoiNhiemTu', 0.01)">+</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label">L√Ω do thay ƒë·ªïi ng∆∞·ªùi c√†i ƒë·∫∑t (n·∫øu c√≥ thay ƒë·ªïi)</label>
                                        <textarea class="form-control" id="mdLyDoThayDoi" rows="3" placeholder="Nh·∫≠p l√Ω do n·∫øu c√≥ thay ƒë·ªïi..."></textarea>
                                    </div>

                                    <!-- Fe Standards Testing -->
                                    <h6 class="border-bottom pb-2 mb-3 text-primary">Ki·ªÉm tra m·∫´u chu·∫©n Fe</h6>
                                    
                                    <!-- Fe 1.5 -->
                                    <div class="mb-4">
                                        <label class="form-label">S·ªë m·∫´u chu·∫©n Fe 1.5 m√°y d√≤ b·∫Øt ƒë∆∞·ª£c</label>
                                        <div class="selection-grid" id="fe15Grid">
                                            <button type="button" class="grid-btn" data-value="1">1</button>
                                            <button type="button" class="grid-btn" data-value="2">2</button>
                                            <button type="button" class="grid-btn" data-value="3">3</button>
                                            <button type="button" class="grid-btn" data-value="4">4</button>
                                            <button type="button" class="grid-btn" data-value="5">5</button>
                                            <button type="button" class="grid-btn" data-value="6">6</button>
                                            <button type="button" class="grid-btn" data-value="7">7</button>
                                            <button type="button" class="grid-btn" data-value="8">8</button>
                                            <button type="button" class="grid-btn" data-value="9">9</button>
                                            <button type="button" class="grid-btn" data-value="10">10</button>
                                        </div>
                                        <input type="hidden" id="mdFe15" name="fe15">
                                    </div>

                                    <!-- Fe 2.0 -->
                                    <div class="mb-4">
                                        <label class="form-label">S·ªë m·∫´u chu·∫©n Fe 2.0 m√°y d√≤ b·∫Øt ƒë∆∞·ª£c</label>
                                        <div class="selection-grid reverse-order" id="fe20Grid">
                                            <button type="button" class="grid-btn" data-value="7">7</button>
                                            <button type="button" class="grid-btn" data-value="6">6</button>
                                            <button type="button" class="grid-btn" data-value="5">5</button>
                                            <button type="button" class="grid-btn" data-value="4">4</button>
                                            <button type="button" class="grid-btn" data-value="3">3</button>
                                            <button type="button" class="grid-btn" data-value="2">2</button>
                                            <button type="button" class="grid-btn" data-value="1">1</button>
                                            <button type="button" class="grid-btn" data-value="10">10</button>
                                            <button type="button" class="grid-btn" data-value="9">9</button>
                                            <button type="button" class="grid-btn" data-value="8">8</button>
                                        </div>
                                        <input type="hidden" id="mdFe20" name="fe20">
                                    </div>

                                    <!-- Submit Buttons -->
                                    <div class="d-flex gap-2 justify-content-end">
                                        <button type="button" class="btn btn-secondary" id="mdCancelBtn">
                                            Cancel
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Save
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data View Form -->
                <div class="form-container" id="data-view-form">
                    <div class="container-fluid py-4">
                        <div class="card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">
                                    <i class="bi bi-table me-2"></i>
                                    Xem d·ªØ li·ªáu ƒë√£ nh·∫≠p
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Th·ªùi gian</th>
                                                <th>Site</th>
                                                <th>Line</th>
                                                <th>Lo·∫°i</th>
                                                <th>S·∫£n ph·∫©m</th>
                                                <th>Thao t√°c</th>
                                            </tr>
                                        </thead>
                                        <tbody id="dataTableBody">
                                            <tr><td colspan="6" class="text-center">ƒêang t·∫£i d·ªØ li·ªáu...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-container" id="analytics-form">
                    <div class="container-fluid py-4">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            Module ph√¢n t√≠ch d·ªØ li·ªáu - ƒëang ph√°t tri·ªÉn
                        </div>
                    </div>
                </div>
                
                <div class="form-container" id="parameters-form">
                    <div class="container-fluid py-4">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            C√†i ƒë·∫∑t th√¥ng s·ªë h·ªá th·ªëng - ƒëang ph√°t tri·ªÉn
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Message here
            </div>
        </div>
    </div>

    <!-- Development Tools -->
    <div class="dev-tools">
        <button class="btn btn-sm btn-outline-danger" onclick="devMode.clearData()" title="Clear All Data">
            <i class="bi bi-trash"></i>
        </button>
        <button class="btn btn-sm btn-outline-info" onclick="devMode.exportData()" title="Export Data">
            <i class="bi bi-download"></i>
        </button>
        <button class="btn btn-sm btn-outline-success" onclick="sharepointManager.generateSampleData()" title="Generate Sample Data">
            <i class="bi bi-plus-square"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sharepoint.js"></script>
    <script src="js/form.js"></script>
    <script src="js/metal-detection.js"></script>
    <script src="js/app.js"></script>

    <script>
    // Global function for number input adjustment (called from metal detection form)
    window.adjustNumber = function(inputId, delta) {
        const input = document.getElementById(inputId);
        if (input) {
            let currentValue = parseFloat(input.value) || 0;
            let newValue = currentValue + delta;
            
            // Ensure non-negative values
            newValue = Math.max(0, newValue);
            
            // Format based on input type
            if (inputId === 'mdNguoiNhiemTu') {
                input.value = newValue.toFixed(2);
            } else {
                input.value = Math.round(newValue);
            }
            
            // Trigger input event for validation
            input.dispatchEvent(new Event('input', { bubbles: true }));
        }
    };

    // Initialize metal detection form when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        // Setup grid button listeners for metal detection form
        function setupMetalDetectionGrids() {
            const gridContainers = ['lineGrid', 'fe15Grid', 'fe20Grid'];
            
            gridContainers.forEach(gridId => {
                const grid = document.getElementById(gridId);
                if (grid) {
                    const buttons = grid.querySelectorAll('.grid-btn');
                    buttons.forEach(btn => {
                        btn.addEventListener('click', function(e) {
                            e.preventDefault();
                            
                            // Remove selected class from all buttons in this grid
                            buttons.forEach(b => b.classList.remove('selected'));
                            
                            // Add selected class to clicked button
                            this.classList.add('selected');
                            
                            // Update corresponding hidden input
                            const value = this.getAttribute('data-value');
                            const hiddenInputMap = {
                                'lineGrid': 'mdLine',
                                'fe15Grid': 'mdFe15',
                                'fe20Grid': 'mdFe20'
                            };
                            
                            const inputId = hiddenInputMap[gridId];
                            if (inputId) {
                                const input = document.getElementById(inputId);
                                if (input) {
                                    input.value = value;
                                }
                            }
                        });
                    });
                }
            });
        }

        // Setup metal detection form submit
        function setupMetalDetectionForm() {
            const form = document.getElementById('metalDetectionForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Collect form data
                    const formData = {
                        id: document.getElementById('mdId').value,
                        site: document.getElementById('mdSite').value,
                        maNhanVien: document.getElementById('mdMaNhanVien').value,
                        ngaySanXuat: document.getElementById('mdNgaySanXuat').value,
                        gioKiemTra: document.getElementById('mdGioKiemTra').value,
                        donViQuaMayDo: document.querySelector('input[name="donViQuaMayDo"]:checked')?.value || '',
                        line: document.getElementById('mdLine').value,
                        nguoiNhiemTu: document.getElementById('mdNguoiNhiemTu').value,
                        lyDoThayDoi: document.getElementById('mdLyDoThayDoi').value,
                        fe15: document.getElementById('mdFe15').value,
                        fe20: document.getElementById('mdFe20').value,
                        timestamp: new Date().toISOString(),
                        formType: 'metal-detection'
                    };
                    
                    // Save to localStorage
                    let metalDetectionData = localStorage.getItem('qaMetalDetectionData');
                    metalDetectionData = metalDetectionData ? JSON.parse(metalDetectionData) : [];
                    metalDetectionData.push(formData);
                    localStorage.setItem('qaMetalDetectionData', JSON.stringify(metalDetectionData));
                    
                    // Show success message
                    if (typeof app !== 'undefined') {
                        app.showToast('Th√†nh c√¥ng', 'D·ªØ li·ªáu ki·ªÉm so√°t kim lo·∫°i ƒë√£ ƒë∆∞·ª£c l∆∞u!', 'success');
                        app.refreshDashboard?.();
                    }
                    
                    // Reset form
                    form.reset();
                    document.querySelectorAll('.grid-btn.selected').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                    
                    // Reset date and time
                    const now = new Date();
                    document.getElementById('mdNgaySanXuat').value = now.toISOString().split('T')[0];
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    document.getElementById('mdGioKiemTra').value = `${hours}:${minutes}`;
                    
                    // Generate new ID
                    const timestamp = now.getTime().toString(36);
                    const random = Math.random().toString(36).substring(2, 8);
                    document.getElementById('mdId').value = timestamp + random;
                });
            }
        }

        // Setup cancel button
        function setupMetalDetectionCancel() {
            const cancelBtn = document.getElementById('mdCancelBtn');
            if (cancelBtn) {
                cancelBtn.addEventListener('click', function() {
                    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy v√† x√≥a to√†n b·ªô d·ªØ li·ªáu ƒë√£ nh·∫≠p?')) {
                        const form = document.getElementById('metalDetectionForm');
                        if (form) {
                            form.reset();
                            document.querySelectorAll('.grid-btn.selected').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                        }
                        if (typeof app !== 'undefined') {
                            app.showToast('Th√¥ng b√°o', 'ƒê√£ h·ªßy v√† l√†m m·ªõi form', 'info');
                        }
                    }
                });
            }
        }

        // Initialize all metal detection features
        setupMetalDetectionGrids();
        setupMetalDetectionForm();
        setupMetalDetectionCancel();
        
        // Generate initial ID and set current date/time for metal detection form
        const now = new Date();
        const timestamp = now.getTime().toString(36);
        const random = Math.random().toString(36).substring(2, 8);
        const idField = document.getElementById('mdId');
        if (idField) {
            idField.value = timestamp + random;
        }
        
        const dateField = document.getElementById('mdNgaySanXuat');
        if (dateField) {
            dateField.value = now.toISOString().split('T')[0];
        }
        
        const timeField = document.getElementById('mdGioKiemTra');
        if (timeField) {
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            timeField.value = `${hours}:${minutes}`;
        }
    });
    </script>
</body>
</html>
